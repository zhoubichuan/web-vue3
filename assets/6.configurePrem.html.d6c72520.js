import{_ as s,o as n,c as a,a as l}from"./app.8390b8a1.js";const p={},e=l(`<h1 id="\u516D-\u6743\u9650\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u516D-\u6743\u9650\u7BA1\u7406" aria-hidden="true">#</a> \u516D.\u6743\u9650\u7BA1\u7406</h1><div class="custom-container tip"><p class="custom-container-title">\u524D\u8A00</p><p>\u524D\u7AEF\u8BBE\u7F6E\u6743\u9650\u53EF\u4EE5\u5BF9\u7528\u6237\u8BBF\u95EE\u7CFB\u7EDF\u8FDB\u884C\u63A7\u5236\uFF0C\u6309\u7167\u5B89\u5168\u89C4\u5219\u3001\u5B89\u5168\u7B56\u7565\u63A7\u5236\u7528\u6237\u53EA\u80FD\u8BBF\u95EE\u88AB\u6388\u6743\u7684\u8D44\u6E90\uFF0C\u4E00\u822C\u5305\u542B <strong>\u8BA4\u8BC1</strong> \u548C <strong>\u6388\u6743</strong> \u4E24\u90E8\u5206</p></div><ul><li>1.\u57FA\u4E8E\u89D2\u8272\u7684\u8BBF\u95EE\u63A7\u5236</li><li>2.\u57FA\u4E8E\u8D44\u6E90\u7684\u8BBF\u95EE\u63A7\u5236</li></ul><h2 id="_1-\u8DEF\u7531\u6743\u9650" tabindex="-1"><a class="header-anchor" href="#_1-\u8DEF\u7531\u6743\u9650" aria-hidden="true">#</a> 1.\u8DEF\u7531\u6743\u9650</h2><ul><li>\u9996\u5148\u5728\u8DEF\u7531\u5B9A\u4E49\u9875\u9762\u5B9A\u4E49\u8DEF\u7531\u76F8\u5173\u4FE1\u606F\uFF0Cmeta \u4E2D\u7684\u5B57\u6BB5\u63A7\u5236\u76F8\u5173\u7684\u6743\u9650 <ul><li>requiresAuth\uFF1A \u662F\u5426\u767B\u5F55</li><li>role\uFF1A\u7528\u6237\u662F\u90A3\u79CD\u89D2\u8272\u624D\u80FD\u8FDB\u5165</li></ul></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">{</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">path</span><span style="color:#24292F;">: </span><span style="color:#0A3069;">&#39;/user&#39;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">name</span><span style="color:#24292F;">: </span><span style="color:#0A3069;">&#39;\u7528\u6237&#39;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">component</span><span style="color:#24292F;">: User,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">meta</span><span style="color:#24292F;">: { </span><span style="color:#953800;">requiresAuth</span><span style="color:#24292F;">: </span><span style="color:#0550AE;">true</span><span style="color:#24292F;">, </span><span style="color:#953800;">role</span><span style="color:#24292F;">:[</span><span style="color:#0A3069;">&#39;1&#39;</span><span style="color:#24292F;">] }</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6839\u636E\u540E\u7AEF\u8FD4\u56DE\u7684\u6570\u636E\uFF0C\u683C\u5F0F\u5316\u6811\u7ED3\u6784\uFF0C\u5E76\u63D0\u53D6\u7528\u6237\u6743\u9650</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// \u9ED8\u8BA4\u8BBE\u7F6E\u6CA1\u6709\u83B7\u53D6\u8FC7\u6743\u9650</span></span>
<span class="line"><span style="color:#CF222E;">export</span><span style="color:#953800;"> </span><span style="color:#CF222E;">default</span><span style="color:#953800;"> </span><span style="color:#CF222E;">new</span><span style="color:#953800;"> </span><span style="color:#24292F;">Vuex</span><span style="color:#953800;">.</span><span style="color:#8250DF;">Store</span><span style="color:#953800;">({</span></span>
<span class="line"><span style="color:#953800;">  </span><span style="color:#24292F;">state: {</span></span>
<span class="line"><span style="color:#24292F;">    hasPermission: </span><span style="color:#0550AE;">false</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  }</span><span style="color:#953800;">,</span></span>
<span class="line"><span style="color:#953800;">  </span><span style="color:#24292F;">mutations: {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">setPermission</span><span style="color:#24292F;">(</span><span style="color:#953800;">state</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">      state.hasPermission </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">true</span><span style="color:#24292F;">;</span></span>
<span class="line"><span style="color:#24292F;">    },</span></span>
<span class="line"><span style="color:#24292F;">  }</span><span style="color:#953800;">,</span></span>
<span class="line"><span style="color:#953800;">})</span><span style="color:#24292F;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8DEF\u7531\u8FDB\u5165\u524D\u6267\u884C\u76F8\u5173\u903B\u8F91\uFF0C\u8C03\u7528\u63A5\u53E3\uFF0C\u8FD4\u56DE\u7684\u53C2\u6570\u53EF\u4EE5\u62FF\u5230\u7528\u6237\u7684\u76F8\u5173\u4FE1\u606F\uFF0C\u6765\u5224\u65AD\u76F8\u5173\u8DEF\u7531\u662F\u5426\u663E\u793A</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">router.</span><span style="color:#8250DF;">beforeEach</span><span style="color:#24292F;">(</span><span style="color:#CF222E;">async</span><span style="color:#24292F;"> (</span><span style="color:#953800;">to</span><span style="color:#24292F;">, </span><span style="color:#953800;">from</span><span style="color:#24292F;">, </span><span style="color:#953800;">next</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (</span><span style="color:#CF222E;">!</span><span style="color:#24292F;">store.state.hasPermission) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// \u83B7\u53D6\u6700\u65B0\u8DEF\u7531\u5217\u8868</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">let</span><span style="color:#24292F;"> newRoutes </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">await</span><span style="color:#24292F;"> store.</span><span style="color:#8250DF;">dispatch</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;getRouteList&quot;</span><span style="color:#24292F;">);</span></span>
<span class="line"><span style="color:#24292F;">    router.</span><span style="color:#8250DF;">addRoutes</span><span style="color:#24292F;">(newRoutes); </span><span style="color:#6E7781;">// \u589E\u52A0\u65B0\u8DEF\u7531</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">next</span><span style="color:#24292F;">({ </span><span style="color:#CF222E;">...</span><span style="color:#24292F;">to, replace: </span><span style="color:#0550AE;">true</span><span style="color:#24292F;"> });</span></span>
<span class="line"><span style="color:#24292F;">  } </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">next</span><span style="color:#24292F;">(); </span><span style="color:#6E7781;">// \u83B7\u53D6\u8FC7\u5C31\u4E0D\u9700\u8981\u518D\u6B21\u83B7\u53D6\u4E86</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"><span style="color:#24292F;">});</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u83B7\u53D6\u76F8\u5173\u9700\u8981\u6570\u636E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> {authRoutes} </span><span style="color:#CF222E;">from</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&#39;./router&#39;</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">getRoutes</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">auth</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">filter</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span><span style="color:#953800;">authRoutes</span><span style="color:#24292F;">)</span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;">{</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> authRoutes.</span><span style="color:#8250DF;">filter</span><span style="color:#24292F;">(</span><span style="color:#953800;">route</span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;">{</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// \u5305\u542B\u6743\u9650</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">if</span><span style="color:#24292F;">(auth.</span><span style="color:#8250DF;">includes</span><span style="color:#24292F;">(route.name)){</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">if</span><span style="color:#24292F;">(route.children){</span></span>
<span class="line"><span style="color:#24292F;">          route.children </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">filter</span><span style="color:#24292F;">(route.children);</span></span>
<span class="line"><span style="color:#24292F;">        }</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">true</span><span style="color:#24292F;">;</span></span>
<span class="line"><span style="color:#24292F;">      }</span></span>
<span class="line"><span style="color:#24292F;">    })</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">filter</span><span style="color:#24292F;">(authRoutes);</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// \u83B7\u53D6\u9700\u8981\u6DFB\u52A0\u7684\u8DEF\u7531\u5217\u8868</span></span>
<span class="line"><span style="color:#24292F;">async </span><span style="color:#8250DF;">getRouteList</span><span style="color:#24292F;">({ dispatch, commit }) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">let</span><span style="color:#24292F;"> auths </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">await</span><span style="color:#24292F;"> axios.</span><span style="color:#8250DF;">get</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;http://localhost:3000/roleAuth&quot;</span><span style="color:#24292F;">);</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">let</span><span style="color:#24292F;"> menuList </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> auths.data.menuList;</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">let</span><span style="color:#24292F;"> { menu, auth } </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">getMenListAndAuth</span><span style="color:#24292F;">(menuList);</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">commit</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;setMenu&quot;</span><span style="color:#24292F;">, menu); </span><span style="color:#6E7781;">// \u5C06\u83DC\u5355\u6570\u636E\u4FDD\u5B58\u8D77\u6765</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">commit</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;setPermission&quot;</span><span style="color:#24292F;">); </span><span style="color:#6E7781;">// \u6743\u9650\u83B7\u53D6\u5B8C\u6BD5</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// \u901A\u8FC7auth\u67E5\u627E\u9700\u8981\u6DFB\u52A0\u7684\u8DEF\u7531</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">getRoutes</span><span style="color:#24292F;">(auth);</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-\u6309\u94AE\u6743\u9650" tabindex="-1"><a class="header-anchor" href="#_2-\u6309\u94AE\u6743\u9650" aria-hidden="true">#</a> 2.\u6309\u94AE\u6743\u9650</h2><p>\u6743\u9650\u6570\u636E</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#953800;">state</span><span style="color:#24292F;">: {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">hasPermission</span><span style="color:#24292F;">: </span><span style="color:#0550AE;">false</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">menu</span><span style="color:#24292F;">: [], </span><span style="color:#6E7781;">// \u83DC\u5355\u6743\u9650</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">btnPermission</span><span style="color:#24292F;">:{ </span><span style="color:#6E7781;">// \u6309\u94AE\u6743\u9650</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#953800;">edit</span><span style="color:#24292F;">:</span><span style="color:#0550AE;">false</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#953800;">add</span><span style="color:#24292F;">:</span><span style="color:#0550AE;">true</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5168\u5C40\u81EA\u5B9A\u4E49\u6307\u4EE4</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#953800;">directives</span><span style="color:#24292F;">: {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">perm</span><span style="color:#24292F;">: {</span></span>
<span class="line"><span style="color:#24292F;">   </span><span style="color:#8250DF;">inserted</span><span style="color:#24292F;">(el, bindings, vnode) {</span></span>
<span class="line"><span style="color:#24292F;">     </span><span style="color:#CF222E;">let</span><span style="color:#24292F;"> value </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> bindings.value;</span></span>
<span class="line"><span style="color:#24292F;">     </span><span style="color:#6E7781;">// \u5728vuex\u4E2D\u67E5\u770B\u662F\u5426\u6709\u6309\u94AE\u6743\u9650</span></span>
<span class="line"><span style="color:#24292F;">     </span><span style="color:#CF222E;">let</span><span style="color:#24292F;"> flag </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> vnode.context.$store.state.btnPermission[value];</span></span>
<span class="line"><span style="color:#24292F;">     </span><span style="color:#6E7781;">// \u5982\u679C\u6CA1\u6709\u5168\u9009\u5219\u5C06\u6309\u94AE\u5220\u9664\u5373\u53EF</span></span>
<span class="line"><span style="color:#24292F;">     </span><span style="color:#CF222E;">!</span><span style="color:#24292F;">flag </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> el.parentNode.</span><span style="color:#8250DF;">removeChild</span><span style="color:#24292F;">(el);</span></span>
<span class="line"><span style="color:#24292F;">   }</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"><span style="color:#24292F;"> }</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">el-button</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">v-perm</span><span style="color:#CF222E;">=</span><span style="color:#0A3069;">&quot;&#39;edit&#39;&quot;</span><span style="color:#24292F;">&gt;\u7F16\u8F91&lt;/</span><span style="color:#116329;">el-button</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">el-button</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">v-perm</span><span style="color:#CF222E;">=</span><span style="color:#0A3069;">&quot;&#39;add&#39;&quot;</span><span style="color:#24292F;">&gt;\u6DFB\u52A0&lt;/</span><span style="color:#116329;">el-button</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,19),o=[e];function c(r,t){return n(),a("div",null,o)}const y=s(p,[["render",c],["__file","6.configurePrem.html.vue"]]);export{y as default};
